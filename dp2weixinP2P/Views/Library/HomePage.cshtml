@model List<dp2weixin.service.SubjectItem>
@section style {
    <style>
        /*================栏目div============*/
        DIV.subject {
            padding: 0px;
            /* background-color: blue;*/
            padding-bottom: 10px;
        }

            DIV.subject .firstline {
                padding: 10px;
            }

                DIV.subject .firstline .title {
                    font-size: 24px;
                }

                DIV.subject .firstline .count {
                    font-size: 18px;
                    color: #999999;
                }

        /*=======消息div===========*/
        DIV.message {
            margin-top: 5px;
            margin-bottom: 5px;
            padding: 10px;
            /*background-color: green;*/
        }

            /*消息div下的table*/
            DIV.message TABLE {
                width: 100%;
                /*background-color: red;*/
            }

                /*=======消息查看态===========*/

                /*消息标题*/
                DIV.message TABLE.view .title {
                    font-size: 18px;
                }

                /*标题右侧的按钮*/
                DIV.message TABLE.view .btn {
                    text-align: right;
                    padding-right: 10px;
                }

                /*消息发布时间*/
                DIV.message TABLE.view .time {
                    color: gray;
                    font-size: 12px;
                }

        /*消息内容*/
        DIV.messageTABLE.view .content {
        }

        /*=============*/
        /*消息编辑态标题*/
        DIV.message INPUT, SELECT {
            margin-bottom: 0px;
        }

        DIV.message TABLE.edit tr td {
            padding: 5px;
        }

            DIV.message TABLE.edit tr td.label {
                color: #999999;
                width: 40px;
            }

            DIV.message TABLE.edit tr td span.label {
                color: #999999;
            }

        DIV.message TABLE.edit select {
            font-size: 17px;
            height: 37px;
            padding: 0px;
            margin: 0px;
        }

        DIV.message TABLE.edit input, textarea {
            padding: 5px;
            margin: 0px;
        }

        /*======是否可编辑态样式=============*/
        .msgEditable {
            background-color: #CCFF99;
        }
    </style>
}
@section Scripts {
    <script>

        //$(document).ready调用是jQuery推迟函数执行的一项标准技术，
        //它直到浏览器加载并处理了文档的所有HTML元素之后才会执行。
        $(document).ready(function () {

            ko.applyBindings(model);

            // 设顶部菜单不固定
            $("#myheader").css("position", "absolute");

            // 填充subject内容
            window.setTimeout("fillPending()", 1);
        })


        var model = {
            subjectHtml: ko.observable("")
        }




        // 栏目切换，将选择的subject设到输入框中
        function subjectChanged(bGetTemplate) {
            var subValue = $("#selSubject").val();

            //alert(subValue);

            if (subValue == "new") {
                $("#divNewSubject").css('display', 'block');
                $("#_val_subject").val("");
                //$("#txtSubject").css('display', 'block');
            }
            else {
                $("#divNewSubject").css('display', 'none');
                $("#_val_subject").val(subValue);

                if (bGetTemplate == true)
                {
                    // 取模板
                    getTemplate(subValue);                    
                }
            }
        }

        //用于获取栏目
        function getTemplate(subject) {
            var libId = getLibId(); //$("#selLib").val();
            if (libId == "") {
                return;
            }

            //显示等待图层
            var index = loadLayer();
            // 调web api
            var url = "/api/LibMessage?group=" + encodeURIComponent("gn:_lib_homePage")
                + "&libId=" + libId
            + "&subject=" + encodeURIComponent(subject);
            //alert(url);
            sendAjaxRequest(url, "GET", function (result) {
                // 关闭等待层
                layer.close(index);

                if (result.errorCode == -1) {
                    alert(result.errorInfo);
                    return;
                }

                $("#_val_content").val(result.info);
                
            }, function (xhq, textStatus, errorThrown) {

                alert("访问服务器出错：\r\n" + errorThrown);
                // 关闭等待层
                layer.close(index);
            });
        }

    </script>
}
@section header {
    <h1 class="mui-title">图书馆主页</h1>
}
<span id="weixinId" style="display:none">@Session[dp2weixin.service.WeiXinConst.C_Session_WeiXinId]</span>
<span id="_userName" style="display:none">@ViewBag.userName</span>
<span id="_group" style="display:none">gn:_lib_homePage</span>

@if (Model == null || Model.Count==0)
{ 
<div class="mui-card" id="divNo" style="margin-top:10px;">
    <center>
        <img src='../img/empty2.jpg' width='100' height='100' style=" padding-top:5px" />
        <div>目前没有栏目。</div>
    </center>
</div>
}

@if (String.IsNullOrEmpty(ViewBag.userName) == false)
{
<div id="divNew" >
    <div id='_edit_new' class="mui-card message" style="display:none"></div>
    <div class="mui-content-padded">
        <button id="btnCreate" class="mui-btn mui-btn-block mui-btn-primary" onclick="gotoEdit('new')">
            新发布信息
        </button>
    </div>
</div>
}

<div  id="_subject_main">
    @foreach (dp2weixin.service.SubjectItem subject in Model)
    {
        if (subject.count == 0)
        {
            continue;
        }
        
        <div id='_subject_@subject.name'  class='subject'>
                                   <div id='_subject_title' class='firstline'><span class='title'>@subject.name</span></div>
                                  <div  class='pending' >
                                    <label>su-@subject.name</label>
                                    <img src='../img/wait2.gif' />
                                      <span>@ViewBag.LibId</span>
                                   </div>
                              </div>
    }
</div>

